<!-- This file is part of Ustad Mobile.  
    
    Ustad Mobile Copyright (C) 2011-2013 Toughra Technologies FZ LLC.

    Ustad Mobile is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version with the following additional terms:
    
    All names, links, and logos of Ustad Mobile and Toughra Technologies FZ 
    LLC must be kept as they are in the original distribution.  If any new
    screens are added you must include the Ustad Mobile logo as it has been
    used in the original distribution.  You may not create any new 
    functionality whose purpose is to diminish or remove the Ustad Mobile 
    Logo.  You must leave the Ustad Mobile logo as the logo for the 
    application to be used with any launcher (e.g. the mobile app launcher).  
    
    If you want a commercial license to remove the above restriction you must
    contact us.  
    
    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.

    Ustad Mobile is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.




This program is free software.  It is licensed under the GNU GENERAL PUBLIC LICENSE ( http://www.gnu.org/copyleft/gpl.html ) with the following 

GPL License Additional Terms

All names, links, and logos of Ustad Mobile and Toughra Technologies FZ LLC must be kept as they are in the original distribution.  If any new screens are added you must include the Ustad Mobile logo as it has been used in the original distribution.  You may not create any new functionality whose purpose is to diminish or remove the Ustad Mobile Logo.  You must leave the Ustad Mobile logo as the logo for the application to be used with any launcher (e.g. the mobile app launcher).  

If you need a commercial license to remove these restrictions please contact us by emailing info@ustadmobile.com 

-->

<!--
    This file will test File API with resolveLocalFileSystemURI tests and resolveFileSystem. Works on all platfroms as you can specify what path to validate. Although they are essentially the same, this is a faster method of testing a directory exists or not in both the API's.
-->

<!DOCTYPE html>
<html>
  <head>
    <title>Ustad Mobile Root</title>
    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
	<script src="js/jquery-1.9.1.min.js" type='text/javascript'></script>

    <link rel='stylesheet' href='css/qunit-1.12.0.css' type='text/css'/>
    <script type="text/javascript">

      //var pathURI = "x-wmapp0:///";
      var pathURI = "";
      //var pathRFS = "/Shared/";
      var pathRFS = "";

      function onErrorURI(){
      alert("Something Wrong! with window.resolveLocalFileSystemURI of path: " + pathURI);
      console.log("Something wrong with window.resolveLocalFileSystemURI of path: " + pathURI);
      }

      function uriTest(){
      //alert("in uri");
      pathURI=$("#uriValue").val();
      alert("path is: " + pathURI);
      document.addEventListener('deviceready', dirURITest, fail);
      }

      function dirURITest(){
      alert("Attempting to access URI file system (resolveLocalFileSystemURI)");
      window.resolveLocalFileSystemURI(pathURI, onSuccessURI, onErrorURI);
      }

      function onSuccessURI(fileSystem){
      alert("Got URI file system!");
      console.log("File System is: " + fileSystem.name);
      alert("File System name: " + fileSystem.name);
      var reader = fileSystem.createReader();
      reader.readEntries(getList, fail);
      }

      function getList(entries){
      alert("Reading through the files and folders in the file System");
      console.log("Ready to read through the reader entries");
      var i;
      var list;
      for (i=0; i < entries.length; i++){
              console.log('Entry '+ i + ' name is: ' + entries[i].name);
              if (entries[i].isDirectory){
                console.log(entries[i].name + " is a directory!");
                }
              list = list + 'Entry '+ i + ' name is: ' + entries[i].name;
              } 
        alert("The list of files/folders in the file System: " + list);
      }
        
      function gotFileEntry2(fileEntry){
        alert("gotFileEntry2");
        alert(fileEntry.fullPath);
      }

      /*
      */
      function fail(evt) {
        console.log(evt.target.error.code);
        //debugLog("Something went wrong");
        alert("Something went wrong.");
      }

      function onError(error) {
        console.log("unable to retrieve file system: " + error.code);
      }
      
      function deviceProperties(){
        document.addEventListener('deviceready', getDeviceProperties, fail);
      }
      
      function getDeviceProperties(){
        var element = document.getElementById('deviceProperties');
        element.innerHTML = 'Device Model: '    + device.model    + '<br />' +
                            'Device Cordova: '  + device.cordova  + '<br />' +
                            'Device Platform: ' + device.platform + '<br />' +
                            'Device UUID: '     + device.uuid     + '<br />' +
                            'Device Version: '  + device.version  + '<br />';
      }

      function getRootPath(){
        pathRFS=$("#rfsValue").val();
        alert("path is: " + pathRFS);
        document.addEventListener('deviceready',getFileSystemRoot, fail);
      }

      function getFileSystemRoot() {
        console.log("Attempting to get System Root via requestFileSystem");
        alert("Attempting to get System root via requestFileSystem");
        var fileSystem;
        var persistent_root;
        console.log("Again..");
        
        if (typeof persistent_root === 'undefined') {
          console.log("undefined persistent_root.. ");
          window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, gotRootDir, fail);
          console.log("persistent post log success.");
        }
      }
      
      function gotRootDir(rootFileSystem){
        console.log("In gotRootDir()");
        console.log("persistent success.");
        console.log("Root fullPath is: " + rootFileSystem.root.fullPath);
        alert("Attempting to get the File System for path: " + pathRFS);
        //dataDir = rootFileSystem.root;
        dataDir = rootFileSystem.root.getDirectory(pathRFS, {create: false}, gotDirectory, gotDirectoryFail);
        //var reader = dataDir.createReader();
        //reader.readEntries(getList, fail);
      }
      
      function gotDirectory(directoryFileSystem){
        alert("Success getting FileSystem for path: " + pathRFS + ". Now getting reader.");
        var reader = directoryFileSystem.createReader();
        reader.readEntries(getList, fail);
      }
 
      function gotDirectoryFail(){
        console.log("Obtaining directory failed for requestFileSystem path: " + pathRFS);
        alert("Obtaining directory failed for RFS path: " + pathRFS);
      }
    </script>

    
    <!--<script src="js/jquery.mobile-1.3.2.min.js" type='text/javascript'></script>-->
	<script src="jqm/jquery.mobile-1.3.2.js" type='text/javascript'></script>

    <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel='stylesheet' href='jqm/jquery.mobile-1.3.2.css' type='text/css'/>


    </head>
  <body data-zone="app">
    This file shows in the console the list of files in the root (or whichever location specified). For testing.
    URI test.
    <p id="deviceProperties">Click to get Device Properties</p>

    <div style="margin-top:30px;">
      <input onclick='deviceProperties()' type="button" id="buttonDeviceProperties"  name="buttonDeviceProperties" value="Get Device Properties">
    </div>

    <div data-role="fieldcontain">
      <label for="name">URI resolveLocalFileSystemURI:</label>
      <input type="text" name="uriValue" id="uriValue" value="//"  />
    </div>
    
    <div style="margin-top:30px;">
      <input onclick='uriTest()' type="button" id="buttonURI"  name="buttonURI" value="URI Check">
    </div>

    <div data-role="fieldcontain">
      <label for="name">RFS window.resolveFileSystem:</label>
      <input type="text" name="rfsValue" id="rfsValue" value="/Shared/"  />
    </div>
    
    <div style="margin-top:30px;">
      <input onclick='getRootPath()' type="button" id="buttonRFS"  name="buttonRFS" value="RFS Check">
    </div>

    <script>
      //uriTest();
      //getRootPath();
    </script>
  
  </body>
</html>
